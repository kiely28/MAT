A. Stocktaking Inventory Result				
	1	Open the Excel workbook containing the macro (Inventory Data Results and Report Macro.xlsm).	Open the Excel workbook containing the macro.	Open the Excel workbook containing the macro.
	2	Ensure SAP GUI is installed and scripting is enabled.	Ensure SAP GUI is installed and scripting is enabled.	Ensure SAP GUI is installed and scripting is enabled.
	3	Launch SAP and confirm login credentials are available.	Launch SAP and confirm login credentials are available.	Launch SAP and confirm login credentials are available.
	4	Run the macro Stocktaking Inventory Results from Excel.	Run the macro Stocktaking Inventory Results from Excel.	Run the macro Stocktaking Inventory Results from Excel.
	5	Macro logs into SAP using provided credentials.	Macro logs into SAP using provided credentials.	Macro logs into SAP using provided credentials.
	6	Macro navigates to the specified TCode (e.g., ZAML3E).		
	7	Macro sets multiple plant codes (e.g., R101, R102, R10A, R10E) in the selection screen.		
	8	Enter selection criteria including plants and file name.		
	9	Execute the transaction and export data to Excel.	Execute the transaction and export data to Excel.	Execute the transaction and export data to Excel.
	10	Delete unnecessary columns from the exported data (e.g., Profit Center).	Delete unnecessary columns from the exported data (e.g., Profit Center).	Delete unnecessary columns from the exported data (e.g., Profit Center).
	11	Format relevant columns (e.g., Price USD).	Format relevant columns (e.g., Price USD).	Format relevant columns (e.g., Price USD).
	12	Calculate total values for numeric columns (e.g., Sys Avail. Quantity(A), Sys Avail. Amount(B) USD).	Calculate total values for numeric columns (e.g., Sys Avail. Quantity(A), Sys Avail. Amount(B) USD).	Calculate total values for numeric columns (e.g., Sys Avail. Quantity(A), Sys Avail. Amount(B) USD).
	13	Calculate percentage values (e.g., Discrepancy Avail. Amt Var(G-H) (I) USD, Sys Avail. Amount(B) USD).	Calculate percentage values (e.g., Discrepancy Avail. Amt Var(G-H) (I) USD, Sys Avail. Amount(B) USD).	Calculate percentage values (e.g., Discrepancy Avail. Amt Var(G-H) (I) USD, Sys Avail. Amount(B) USD).
	14	Set a custom file name based on plant and date (e.g., Plant_ + Month+Year + Result.xlsx).	Set a custom file name based on plant and date (e.g., Plant_ + Month+Year + Result.xlsx).	Set a custom file name based on plant and date (e.g., Plant_ + Month+Year + Result.xlsx).
	15	Create or verify existence of a default folder (e.g., D:\Inventory Data Results and Reports).	Create or verify existence of a default folder (e.g., D:\Inventory Data Results and Reports).	Create or verify existence of a default folder (e.g., D:\Inventory Data Results and Reports).
	16	Save the formatted Excel file to the default folder with the custom name.	Save the formatted Excel file to the default folder with the custom name.	Save the formatted Excel file to the default folder with the custom name.
	17	Close SAP session.	Close SAP session.	Close SAP session.
B. Stocktaking Summary Report				
	1	Exported SAP data to Excel (source: Stocktaking Inventory Results).		
	2	Open the exported Excel file.		
	3	Insert a new worksheet named Pivot Result.		
	4	Create a pivot table in Sheet2 using the exported data.		
	5	Set "Plant" as the row field in the pivot table		
	6	Add relevant columns (e.g., Sys Avail. Quantity(A)) as values in the pivot table.		
	7	Open the provided Excel template file (PR Stock Discrepancy Summary July 2025.xlsx)		
	8	Copy the pivot table data from Sheet2		
	9	Paste the pivot data into the designated area in the template		
	10	Check that formulas in the template (e.g., Overall Total) are calculating correctly		
	11	Save as the updated template file.		
C. Stocktaking Result Per Section Incharge				
	1	Exported SAP data to Excel (source: Stocktaking Inventory Results).		
	2	Open the exported Excel file.		
	3	Insert a new worksheet named Pivot Result.		
	4	Create a pivot table in Sheet2 using the exported data.		
	5	Set "Incharge" as the row field in the pivot table		
	6	Add relevant columns (e.g., Sys Avail. Quantity(A)) as values in the pivot table.		
	7	Open the provided Excel template file (Stocktaking Result Per Section Incharge Template.xlsx)		
	8	Copy the pivot table data from Sheet2		
	9	Paste the pivot data into the designated area in the template		
	10	Check that formulas in the template (e.g., Total) are calculating correctly		
	11	Save as the updated template file.		
D. Difference Posting Check				
	1	Run the Discrepancy Posting Check from Excel.	Run the Discrepancy Posting Check from Excel	Run the Discrepancy Posting Check from Excel
	2	Copy (Sum of Act Avail. Quantity (C)) per plant from the Stocktaking Summary Report pivot table.	Copy Sum of Act Avail. Quantity (C) Per Plant) from the Stocktaking Summary Report pivot table	Copy Sum of Act Avail. Quantity (C) Per Plant) from the Stocktaking Summary Report pivot table
	3	Open the provided Excel template (PR Difference Posting Check.xlsx).	Open the provided Excel template (PR Difference Posting Check.xlsx).	Open the provided Excel template (PR Difference Posting Check.xlsx).
	4	Paste the copied data into the designated area in the template.	Paste the copied data into the designated area in the template	Paste the copied data into the designated area in the template
	5	Check that formulas in the template are calculating correctly.	Check that formulas in the template are calculating correctly	Check that formulas in the template are calculating correctly
	6	Macro logs into SAP using provided credentials.	Macro logs into SAP using provided credentials	Macro logs into SAP using provided credentials
	7	Macro navigates to the specified TCode (e.g., ZAML2M).	Macro navigates to the specified TCode (e.g., ME2N, MB52)	Macro navigates to the specified TCode (e.g., ME2N, MB52)
	8	Macro sets multiple plant codes (e.g.,  R101, R102, R10A, R10E).	Macro sets multiple plant codes (e.g., PL01, PL02, PL03)	Macro sets multiple plant codes (e.g., PL01, PL02, PL03)
	9	Enter selection criteria including plants and file name.	Enter selection criteria including plants and date range	Enter selection criteria including plants and date range
	10	Macro sets a custom file name based on plant and date.	Macro sets a custom file name based on plant and date	Macro sets a custom file name based on plant and date
	11	Execute the transaction and export data to Excel.	Execute the transaction and export data to Excel	Execute the transaction and export data to Excel
	12	Create a pivot table from the exported data with "Plant" as rows and "AVAILABLE" as values.	Create a pivot table from the exported data with "Plant" as rows and "Quantity" as values	Create a pivot table from the exported data with "Plant" as rows and "Quantity" as values
	13	Copy the pivot table data.	Copy the pivot table data	Copy the pivot table data
	14	Paste the pivot data into the designated area in the provided template.	Paste the pivot data into the designated area in the provided template	Paste the pivot data into the designated area in the provided template
	15	Check that formulas in the template (e.g., total) are calculating correctly.	Check that formulas in the template (e.g., totals, percentages) are calculating correctly	Check that formulas in the template (e.g., totals, percentages) are calculating correctly
	16	Save the updated template file to a default folder (e.g., D:\Inventory Data Results and Reports) with the custom file name.	Save the updated template file to a default folder (e.g., C:\SAP_Reports) with the custom file name	Save the updated template file to a default folder (e.g., C:\SAP_Reports) with the custom file name
	17	Close SAP session.	Close SAP session.	Close SAP session.



Hereâ€™s a sample System Diagram Explanation for your detailed Stocktaking Inventory Workflow (Aâ€“D).
You can use this as part of your documentation or proposal â€” it summarizes the data flow, process sequence, and system interaction between Excel VBA macros, SAP, and report templates.


---

ðŸ§­ System Diagram Explanation: Stocktaking Inventory Result and Reporting Automation

1. Overview

The system automates the end-to-end process of stocktaking result extraction, calculation, and reporting through an integrated Excel VBA Macro and SAP GUI scripting workflow. It consists of four main components:

A. Stocktaking Inventory Result Extraction

B. Stocktaking Summary Report

C. Stocktaking Result per Section Incharge

D. Difference Posting Check


All modules interact with SAP GUI, Excel Macros, and predefined Excel templates to produce accurate and consistent reports stored in a shared directory.


---

2. System Components and Interaction Flow

A. Stocktaking Inventory Result

1. User Action:
The user opens the Excel macro file (Inventory Data Results and Report Macro.xlsm) and triggers the Stocktaking Inventory Results process.


2. System Validation:
The macro checks that SAP GUI is installed, scripting is enabled, and login credentials are available.


3. SAP Automation:
The macro logs into SAP automatically, navigates to the target transaction code (e.g., ZAML3E), and sets selection criteria such as Plant Codes (R101, R102, R10A, R10E) and date ranges.


4. Data Extraction and Processing:
SAP exports the raw data to Excel. The macro cleans up unnecessary columns, formats numeric values (e.g., Price USD), and performs calculations for totals and percentage variances.


5. File Generation:
The system assigns a custom file name (e.g., R101_Oct2025_Result.xlsx), ensures the folder D:\Inventory Data Results and Reports exists, and saves the result file.


6. Output:
A formatted Excel file containing stocktaking results per plant, ready for analysis and reporting.




---

B. Stocktaking Summary Report

1. Input:
The exported Excel file from Step A is used as the data source.


2. Data Transformation:
A new worksheet ("Pivot Result") is created, and a Pivot Table summarizes data by Plant (e.g., Sys Avail. Quantity (A)).


3. Template Integration:
The summarized data is copied into the predefined template (PR Stock Discrepancy Summary July 2025.xlsx).


4. Formula Verification & Output:
The template formulas (e.g., Overall Totals) are verified, and the file is saved as an updated summary report.




---

C. Stocktaking Result Per Section Incharge

1. Input:
Source file from Step A (Stocktaking Inventory Results).


2. Data Processing:
The macro creates another Pivot Table, this time grouped by Section Incharge instead of Plant.


3. Template Integration:
The Pivot Table results are pasted into the designated template (Stocktaking Result Per Section Incharge Template.xlsx).


4. Output:
The report shows summarized results per Section Incharge, ensuring accountability and visibility of discrepancies per responsible section.




---

D. Difference Posting Check

1. Trigger:
The user runs the Discrepancy Posting Check macro from the same Excel workbook.


2. Data Consolidation:
Values (e.g., Sum of Actual Available Quantity per Plant) are copied from the Stocktaking Summary Report and pasted into another template (PR Difference Posting Check.xlsx).


3. SAP Validation:
The macro logs into SAP again and navigates to a transaction (e.g., ZAML2M, ME2N, or MB52) to re-extract availability or movement data.


4. Comparison and Analysis:
The exported SAP data is summarized into a Pivot Table for comparison against Excel-calculated results.


5. Template Update and Saving:
The checked and verified difference report is saved under D:\Inventory Data Results and Reports with a plant/date-based file name.


6. End Process:
SAP session is automatically closed after completion.




---

3. Data Flow Summary

Stage	Source	Process	Output	Tool

A	SAP GUI	Data Extraction & Calculation	Formatted Stocktaking Results (.xlsx)	Excel Macro + SAP GUI
B	Excel Result File	Pivot & Summary by Plant	Summary Report Template (.xlsx)	Excel
C	Excel Result File	Pivot by Section Incharge	Section Incharge Report Template (.xlsx)	Excel
D	Summary Report + SAP	Comparison & Validation	Difference Posting Check (.xlsx)	Excel Macro + SAP GUI



---

4. System Architecture Overview

[User]
   â†“
[Excel Macro Workbook (Inventory Data Results and Report Macro.xlsm)]
   â†•
[SAP GUI with Enabled Scripting]
   â†“
[Exported SAP Data]
   â†“
[Excel Pivot Summaries and Templates]
   â†“
[Generated Reports Folder: D:\Inventory Data Results and Reports]

Automation Level: 80â€“90% (minimal manual intervention)

Data Consistency: Ensured via standardized templates and file naming conventions

Security: SAP login credentials handled within macro script (user input required)

Outputs: Four categorized reports â€” Plant-based, Section-based, Summary, and Discrepancy Check



---

5. Benefits

Reduces manual SAP extraction and formatting errors

Accelerates monthly and quarterly stocktaking reporting

Standardizes result structure and naming conventions

Provides automated cross-checking of inventory differences

Ensures audit-ready and plant-level transparency



---

Would you like me to create a visual diagram (system flowchart or data flow diagram) to accompany this explanation (e.g., in image format)? It would show the connection between Excel, SAP, and output files clearly.

